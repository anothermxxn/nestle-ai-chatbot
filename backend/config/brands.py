BRAND_PATTERNS = {
    # Chocolates & Treats
    "Aero": [
        "aero", "AERO", "Aero"
    ],
    "After Eight": [
        "after eight", "AFTER EIGHT", "After Eight",
        "after-eight", "AFTER-EIGHT", "After-Eight", 
        "aftereight", "AFTEREIGHT", "Aftereight"
    ],
    "Big Turk": [
        "big turk", "BIG TURK", "Big Turk",
        "big-turk", "BIG-TURK", "Big-Turk",
        "bigturk", "BIGTURK", "Bigturk"
    ],
    "COFFEE CRISP": [
        "coffee crisp", "COFFEE CRISP", "Coffee Crisp",
        "coffee-crisp", "COFFEE-CRISP", "Coffee-Crisp",
        "coffeecrisp", "COFFEECRISP", "Coffeecrisp"
    ],
    "Crunch": [
        "crunch", "CRUNCH", "Crunch"
    ],
    "Drumstick Bites": [
        "drumstick bites", "DRUMSTICK BITES", "Drumstick Bites",
        "drumstick-bites", "DRUMSTICK-BITES", "Drumstick-Bites",
        "drumstickbites", "DRUMSTICKBITES", "Drumstickbites"
    ],
    "Kit Kat": [
        "kit kat", "KIT KAT", "Kit Kat",
        "kit-kat", "KIT-KAT", "Kit-Kat",
        "kitkat", "KITKAT", "Kitkat"
    ],
    "Mackintosh Toffee": [
        "mackintosh toffee", "MACKINTOSH TOFFEE", "Mackintosh Toffee",
        "mackintosh-toffee", "MACKINTOSH-TOFFEE", "Mackintosh-Toffee",
        "mackintoshtoffee", "MACKINTOSHTOFFEE", "Mackintoshtoffee"
    ],
    "Mirage": [
        "mirage", "MIRAGE", "Mirage"
    ],
    "Quality Street": [
        "quality street", "QUALITY STREET", "Quality Street",
        "quality-street", "QUALITY-STREET", "Quality-Street",
        "qualitystreet", "QUALITYSTREET", "Qualitystreet"
    ],
    "Rolo": [
        "rolo", "ROLO", "Rolo"
    ],
    "Smarties": [
        "smarties", "SMARTIES", "Smarties"
    ],
    "Turtles": [
        "turtles", "TURTLES", "Turtles"
    ],
    
    # Coffee
    "Coffee Mate": [
        "coffee mate", "COFFEE MATE", "Coffee Mate",
        "coffee-mate", "COFFEE-MATE", "Coffee-Mate",
        "coffeemate", "COFFEEMATE", "Coffeemate"
    ],
    "NESCAFÉ": [
        "nescafé", "NESCAFÉ", "Nescafé",
        "nescafe", "NESCAFE", "Nescafe"
    ],
    
    # Ice Cream & Frozen Treats
    "Del Monte": [
        "del monte", "DEL MONTE", "Del Monte",
        "del-monte", "DEL-MONTE", "Del-Monte",
        "delmonte", "DELMONTE", "Delmonte"
    ],
    "Drumstick": [
        "drumstick", "DRUMSTICK", "Drumstick"
    ],
    "Häagen-Dazs": [
        "häagen-dazs", "HÄAGEN-DAZS", "Häagen-Dazs",
        "haagen-dazs", "HAAGEN-DAZS", "Haagen-Dazs",
        "häagendazs", "HÄAGENDAZS", "Häagendazs",
        "haagendazs", "HAAGENDAZS", "Haagendazs",
        "häagen dazs", "HÄAGEN DAZS", "Häagen Dazs",
        "haagen dazs", "HAAGEN DAZS", "Haagen Dazs"
    ],
    "IÖGO": [
        "iögo", "IÖGO", "Iögo",
        "iogo", "IOGO", "Iogo"
    ],
    "Parlour": [
        "parlour", "PARLOUR", "Parlour"
    ],
    "Real Dairy": [
        "real dairy", "REAL DAIRY", "Real Dairy",
        "real-dairy", "REAL-DAIRY", "Real-Dairy",
        "realdairy", "REALDAIRY", "Realdairy"
    ],
    
    # Infant Nutrition
    "Nestlé Materna": [
        "nestlé materna", "NESTLÉ MATERNA", "Nestlé Materna",
        "nestle materna", "NESTLE MATERNA", "Nestle Materna",
        "nestlé-materna", "NESTLÉ-MATERNA", "Nestlé-Materna",
        "nestle-materna", "NESTLE-MATERNA", "Nestle-Materna",
        "nestlématerna", "NESTLÉMATERNA", "Nestlématerna",
        "nestlematerna", "NESTLEMATERNA", "Nestlematerna"
    ],
    "Nido": [
        "nido", "NIDO", "Nido"
    ],
    
    # Meal Times Made Easy
    "MAGGI": [
        "maggi", "MAGGI", "Maggi"
    ],
    
    # Nutrition +
    "BOOST Kids": [
        "boost kids", "BOOST KIDS", "Boost Kids", "BOOST Kids",
        "boost-kids", "BOOST-KIDS", "Boost-Kids",
        "boostkids", "BOOSTKIDS", "Boostkids"
    ],
    "Boost": [
        "boost", "BOOST", "Boost"
    ],
    "IBGard": [
        "ibgard", "IBGARD", "Ibgard", "IBGard"
    ],
    "Nature's Bounty": [
        "nature's bounty", "NATURE'S BOUNTY", "Nature's Bounty",
        "natures bounty", "NATURES BOUNTY", "Natures Bounty",
        "nature's-bounty", "NATURE'S-BOUNTY", "Nature's-Bounty",
        "natures-bounty", "NATURES-BOUNTY", "Natures-Bounty",
        "nature'sbounty", "NATURE'SBOUNTY", "Nature'sbounty",
        "naturesbounty", "NATURESBOUNTY", "Naturesbounty"
    ],
    
    # Pet Foods
    "Purina": [
        "purina", "PURINA", "Purina"
    ],
    
    # Quick-Mix Drinks
    "Carnation Hot Chocolate": [
        "carnation hot chocolate", "CARNATION HOT CHOCOLATE", "Carnation Hot Chocolate",
        "carnation-hot-chocolate", "CARNATION-HOT-CHOCOLATE", "Carnation-Hot-Chocolate",
        "carnationhotchocolate", "CARNATIONHOTCHOCOLATE", "Carnationhotchocolate"
    ],
    "GoodHost": [
        "goodhost", "GOODHOST", "Goodhost", "GoodHost",
        "good host", "GOOD HOST", "Good Host",
        "good-host", "GOOD-HOST", "Good-Host"
    ],
    "Milo": [
        "milo", "MILO", "Milo"
    ],
    "NESTEA": [
        "nestea", "NESTEA", "Nestea"
    ],
    "Nesfruta": [
        "nesfruta", "NESFRUTA", "Nesfruta"
    ],
    "Nesquik": [
        "nesquik", "NESQUIK", "Nesquik"
    ],
    
    # Spring & Sparkling Water
    "Maison Perrier": [
        "maison perrier", "MAISON PERRIER", "Maison Perrier",
        "maison pérrier", "MAISON PÉRRIER", "Maison Pérrier",
        "maison-perrier", "MAISON-PERRIER", "Maison-Perrier",
        "maison-pérrier", "MAISON-PÉRRIER", "Maison-Pérrier",
        "maisonperrier", "MAISONPERRIER", "Maisonperrier",
        "maisonpérrier", "MAISONPÉRRIER", "Maisonpérrier"
    ],
    "Perrier": [
        "perrier", "PERRIER", "Perrier",
        "pérrier", "PÉRRIER", "Pérrier"
    ],
    "San Pellegrino": [
        "san pellegrino", "SAN PELLEGRINO", "San Pellegrino",
        "san-pellegrino", "SAN-PELLEGRINO", "San-Pellegrino",
        "sanpellegrino", "SANPELLEGRINO", "Sanpellegrino"
    ],
}

NESTLE_BRANDS = list(BRAND_PATTERNS.keys())

BRAND_CATEGORIES = {
    # Chocolate & Treats
    "treat": [
        "Aero", "After Eight", "Big Turk", "COFFEE CRISP", "Crunch", 
        "Drumstick Bites", "Kit Kat", "Mackintosh Toffee", "Mirage", 
        "Quality Street", "Rolo", "Smarties", "Turtles"
    ],
    
    # Coffee
    "coffee": ["Coffee Mate", "NESCAFÉ"],
    
    # Ice Cream & Frozen Treats  
    "frozen": ["Del Monte", "Drumstick", "Häagen-Dazs", "IÖGO", "Parlour", "Real Dairy"],
    
    # Infant Nutrition
    "infant": ["Nestlé Materna", "Nido"],
    
    # Meal Times Made Easy
    "meal": ["MAGGI"],
    
    # Nutrition +
    "nutrition": ["Boost", "BOOST Kids", "IBGard", "Nature's Bounty"],
    
    # Pet Foods
    "pet": ["Purina"],
    
    # Quick-Mix Drinks
    "drink": ["Carnation Hot Chocolate", "GoodHost", "Milo", "NESTEA", "Nesfruta", "Nesquik"],
    
    # Spring & Sparkling Water
    "water": ["Maison Perrier", "Perrier", "San Pellegrino"]
}

def normalize_brand_name(brand_name: str) -> str:
    """
    Normalize brand name to match the expected format from BRAND_PATTERNS.
    
    Args:
        brand_name (str): The brand name to normalize.
    
    Returns:
        str: The canonical brand name key from BRAND_PATTERNS if found,
             or the original input if no match is found. Returns None if
             input is None or empty.
    """
    if not brand_name:
        return None
    
    # Strip whitespace and handle basic cases
    normalized_input = brand_name.strip()
    
    # Check if the input exactly matches any brand key
    if normalized_input in BRAND_PATTERNS:
        return normalized_input
    
    # Check if the input matches any variation in BRAND_PATTERNS
    for brand_key, variations in BRAND_PATTERNS.items():
        if normalized_input in variations:
            return brand_key
    
    # If no exact match found, try case-insensitive matching
    normalized_lower = normalized_input.lower()
    for brand_key, variations in BRAND_PATTERNS.items():
        if any(normalized_lower == variation.lower() for variation in variations):
            return brand_key
    
    # If still no match, return the original input
    return normalized_input 

def get_brand_category(brand_name: str) -> str:
    """
    Get the category for a given brand name.
    
    Args:
        brand_name (str): The brand name to categorize.
    
    Returns:
        str: The category name if the brand is found in BRAND_CATEGORIES,
             "other" if the brand exists but has no category, or "unknown" 
             if the input is None or empty.
    """
    if not brand_name:
        return "unknown"
    
    # Normalize the brand name to get the correct key
    normalized_brand = normalize_brand_name(brand_name)
    
    # Check if the normalized brand is in any category
    for category, brands in BRAND_CATEGORIES.items():
        if normalized_brand in brands:
            return category
    return "other"

def get_all_brand_variations():
    """
    Get all brand variations from BRAND_PATTERNS for search/detection.
    
    Returns:
        list[str]: A sorted list of all unique brand variations from 
                   BRAND_PATTERNS.
    """
    all_variations = []
    for brand_variations in BRAND_PATTERNS.values():
        all_variations.extend(brand_variations)
    return sorted(list(set(all_variations)))